# 2026-02-16 - TBH Report Catalog Progress

## Session Summary
Major progress on TBH Report Catalog - switched data source from SLSD to ORDL, built full pipeline with real plant data.

## Completed

### Data Source Switch
- **REJECTED SLSD** - 70+ fields but mostly NULL columns; March 2025 period didn't align
- **ADOPTED ORDL** - Order Detail table, 1000 rows Jan 2025, proven source for NRMCA reports
- Revenue calculated from `price Ã— delv_qty` = $1,979,766.80 from 13,180.77 yards

### Dummy Database (SQLite)
- `data/command_alkon_dummy.db` with 3 tables:
  - **ORDL**: 1000 rows (Jan 2025), 168 products, 22 unique days
  - **TKTC**: 1000 rows (Jan 2021), ticket charges (WSC, FSC), $20K ancillary revenue
  - **PLNT**: 10 rows - plant master with WRM, HRM, FRM, MART, PORT, HRMH + aggregates
- Python builder: `scripts/sqlite/build_dummy_db.py`

### C# Implementation Updated
1. **SqliteCommandAlkonExtractor** - Reads ORDL, extracts plants from PLNT table
2. **PlantPerformanceBuilder** - Aggregates by plant/month, calculates margins
3. **PlantPerformanceExcelGenerator** - EPPlus Excel export with formatting
4. **Demo Program** - Full pipeline working end-to-end

### First Report Generated
- Plant 1 (WRM - Westminster Ready-Mixed): 13,180 yards, $1.98M revenue
- Excel output: `PlantPerformance_20250101_20250201.xlsx`

## Key Technical Decisions
- Plant codes from PLNT now populate reports (was hardcoded "1")
- Cost data still NULL - TKTC `ext_matl_cost_amt` = $0.00 in sample
- ORDL lacks plant codes directly; using PLNT lookup for now

## Waiting For
- [ ] CUST (customer master) - to replace "CUST" placeholder
- [ ] IMST (item master) - product catalog enrichment

## File Locations
- Database: `data/command_alkon_dummy.db`
- Build script: `scripts/sqlite/build_dummy_db.py`
- Run command: `./scripts/run-plant-performance.sh`

## New Inputs / Decisions
- Matt provided **ORDR CSV** plus **TICK** and **TKTL** CSV exports (Jan 2025). These are to become the primary tables for the dummy DB, replacing ORDL usage for Plant Performance.
- Matt wants the dummy database to serve as a **model DB mirroring production**, so reports can be validated on the model before running on real data.
- Recommended first report: **Plant Performance Summary (Monthly)** using TICK/TKTL only (no GL), with metrics for Volume, Revenue, Cost, Margin $, Margin %, $/Yd.
